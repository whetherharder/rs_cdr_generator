# Git Workflow Guide

## Standard Feature Development Workflow

### 1. Create Feature Branch

Always create a new branch from master for any changes:

```bash
# For bug fixes
git checkout -b fix/short-description

# For new features
git checkout -b feature/short-description

# For performance improvements
git checkout -b perf/short-description

# For documentation
git checkout -b docs/short-description
```

### 2. Make Changes

Work on your changes in the feature branch:

```bash
# Make your code changes
# Run tests frequently
cargo test

# Build to check for compilation errors
cargo build --release
```

### 3. Commit Changes

Stage and commit your changes with a descriptive message:

```bash
# Stage specific files
git add src/file1.rs src/file2.rs

# Or stage all changes
git add .

# Commit with detailed message
git commit -m "Short summary (50 chars or less)

Detailed explanation of what changed and why.
- Point 1
- Point 2
- Point 3

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

### 4. Test Before Merging

Always run the full test suite before merging:

```bash
# Run all tests
cargo test

# Run specific test with output
cargo test --test event_counts_test -- --nocapture

# Build release version
cargo build --release
```

### 5. Merge to Master

Once changes are complete and tested:

```bash
# Switch back to master
git checkout master

# Merge with no-fast-forward to preserve branch history
git merge feature/your-branch --no-ff -m "Merge feature/your-branch into master

Brief description of what was merged.

Key changes:
- Change 1
- Change 2
- Change 3

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

### 6. Clean Up

Delete the feature branch after successful merge:

```bash
# Delete local branch
git branch -d feature/your-branch

# If you pushed to remote, delete remote branch
git push origin --delete feature/your-branch
```

## Example: Complete Workflow

```bash
# 1. Create feature branch
git checkout -b fix/race-condition-shard-files

# 2. Make changes
# ... edit files ...

# 3. Stage and commit
git add src/writer.rs src/generators.rs tests/
git commit -m "Fix race condition: add shard_id to output filenames

Problem: Workers were overwriting each other's files
Solution: Add shard_id to filename format

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>"

# 4. Test
cargo test

# 5. Merge to master
git checkout master
git merge fix/race-condition-shard-files --no-ff -m "Merge fix/race-condition-shard-files into master"

# 6. Clean up
git branch -d fix/race-condition-shard-files
```

## Branch Naming Conventions

| Prefix | Purpose | Example |
|--------|---------|---------|
| `fix/` | Bug fixes | `fix/race-condition-shard-files` |
| `feature/` | New features | `feature/json-output-format` |
| `perf/` | Performance improvements | `perf/optimize-cell-lookup` |
| `docs/` | Documentation updates | `docs/update-readme` |
| `refactor/` | Code refactoring | `refactor/extract-parser` |
| `test/` | Test additions/fixes | `test/add-integration-tests` |

## Commit Message Guidelines

### Format

```
Short summary (imperative mood, 50 chars max)

Detailed explanation (wrap at 72 chars):
- What changed
- Why it changed
- How it affects the system

Tests: X/Y passing
Related issue: #123

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

### Good Examples

```
‚úÖ Fix race condition in worker file output
‚úÖ Add integration tests for event generation
‚úÖ Optimize cell lookup with caching
‚úÖ Update README with performance benchmarks
```

### Bad Examples

```
‚ùå Fixed bug
‚ùå Updated files
‚ùå Changes
‚ùå WIP
```

## Pre-Merge Checklist

Before merging any branch to master:

- [ ] All tests pass (`cargo test`)
- [ ] Code compiles without warnings (`cargo build --release`)
- [ ] New features have tests
- [ ] Documentation is updated
- [ ] Commit messages are descriptive
- [ ] No unnecessary files committed (check `.gitignore`)

## Useful Git Commands

```bash
# View branch history
git log --oneline --graph -10

# Check what changed
git diff

# See which files changed
git status

# Undo uncommitted changes
git restore file.rs

# Undo staged changes
git restore --staged file.rs

# View all branches
git branch -a

# Switch branches
git checkout branch-name

# Create and switch to new branch
git checkout -b new-branch-name
```

## Integration with CI/CD

When setting up CI/CD, ensure:

1. All tests run on every commit
2. Release builds are tested
3. Integration tests are included
4. No warnings in compilation
5. Code coverage is tracked

Example GitHub Actions workflow:

```yaml
name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run tests
        run: cargo test --all-features
      - name: Build release
        run: cargo build --release
```
